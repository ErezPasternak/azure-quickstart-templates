{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "(0005) - This template creates a VPC infrastructure for a multi-AZ, multi-tier deployment of an RD Gateway infrstructure. It installs 2 RD Gateways into subnets in seperate AZs inside a public VPC subnet, as well as NAT instances for outbound internet access from private subnets. **WARNING** This template creates Amazon EC2 Windows instance and related resources. You will be billed for the AWS resources used if you create a stack from this template.",
  "Parameters": {
    "KeyPairName": {
      "Description": "Public/private key pairs allow you to securely connect to your instance after it launches",
      "Type": "AWS::EC2::KeyPair::KeyName"
    },
    "NATInstanceType": {
      "Description": "Amazon EC2 instance type for the NAT Instances",
      "Type": "String",
      "Default": "t2.small",
      "AllowedValues": [
        "t2.small",
        "t2.medium"
      ]
    },
    "RDGWInstanceType": {
      "Description": "Amazon EC2 instance type for the Remote Desktop Gatweway Instance",
      "Type": "String",
      "Default": "m4.xlarge",
      "AllowedValues": [
        "m4.large",
        "m4.xlarge",
        "m4.2xlarge",
        "m4.4xlarge"
      ]
    },
    "ESGNetBIOSName1": {
      "Description": "NetBIOS name of the 1st ESG (upto 15 characters)",
      "Type": "String",
      "Default": "ESG1",
      "MinLength": "1",
      "MaxLength": "15",
      "AllowedPattern": "[a-zA-Z0-9]+"
    },
    "ESGNetBIOSName2": {
      "Description": "NetBIOS name of the 2nd ESG (upto 15 characters)",
      "Type": "String",
      "Default": "ESG22",
      "MinLength": "1",
      "MaxLength": "15",
      "AllowedPattern": "[a-zA-Z0-9]+"
    },
    "GRIDNetBIOSName": {
      "Description": "NetBIOS name of the Ericom Connect Grid  (upto 15 characters)",
      "Type": "String",
      "Default": "Broker",
      "MinLength": "1",
      "MaxLength": "15",
      "AllowedPattern": "[a-zA-Z0-9]+"
    },
    "DCNetBIOSName": {
      "Description": "NetBIOS name of the Domain Controller   (upto 15 characters)",
      "Type": "String",
      "Default": "dc1",
      "MinLength": "1",
      "MaxLength": "15",
      "AllowedPattern": "[a-zA-Z0-9]+"
    },
    "RDSHD-0NetBIOSName": {
      "Description": "NetBIOS name of the RDSH server For Desktops   (upto 15 characters)",
      "Type": "String",
      "Default": "rdshd-0",
      "MinLength": "1",
      "MaxLength": "15",
      "AllowedPattern": "[a-zA-Z0-9]+"
    },
    "RDSHA-0NetBIOSName": {
      "Description": "NetBIOS name of the RDSH server For Applications   (upto 15 characters)",
      "Type": "String",
      "Default": "rdsha-0",
      "MinLength": "1",
      "MaxLength": "15",
      "AllowedPattern": "[a-zA-Z0-9]+"
    },
    "AdminUser": {
      "Description": "User name for the new local administrator account",
      "Type": "String",
      "Default": "Ericom",
      "MinLength": "5",
      "MaxLength": "25",
      "AllowedPattern": "[a-zA-Z0-9]*"
    },
    "AdminPassword": {
      "Description": "Password for the administrative account. Must be at least 8 characters containing letters, numbers and symbols",
      "Type": "String",
      "MinLength": "8",
      "MaxLength": "32",
      "AllowedPattern": "(?=^.{6,255}$)((?=.*\\d)(?=.*[A-Z])(?=.*[a-z])|(?=.*\\d)(?=.*[^A-Za-z0-9])(?=.*[a-z])|(?=.*[^A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z])|(?=.*\\d)(?=.*[A-Z])(?=.*[^A-Za-z0-9]))^.*",
      "NoEcho": "true",
      "Default": "Ericom123$"
    },
    "DomainDNSName": {
      "Description": "Fully qualified domain name (FQDN) e.g. example.com",
      "Type": "String",
      "Default": "test.local",
      "MinLength": "3",
      "MaxLength": "25",
      "AllowedPattern": "[a-zA-Z0-9]+\\..+"
    },
    "DMZ1CIDR": {
      "Description": "CIDR Block for the Public DMZ Subnet located in AZ1",
      "Type": "String",
      "Default": "10.0.32.0/20",
      "AllowedPattern": "[a-zA-Z0-9]+\\..+"
    },
    "DMZ2CIDR": {
      "Description": "CIDR Block for the Public DMZ Subnet located in AZ2",
      "Type": "String",
      "Default": "10.0.96.0/20",
      "AllowedPattern": "[a-zA-Z0-9]+\\..+"
    },
    "PrivSub1CIDR": {
      "Description": "CIDR Block for Private Subnet 1 located in AZ1",
      "Type": "String",
      "Default": "10.0.0.0/19",
      "AllowedPattern": "[a-zA-Z0-9]+\\..+"
    },
    "PrivSub2CIDR": {
      "Description": "CIDR Block for Private Subnet 2 located in AZ2",
      "Type": "String",
      "Default": "10.0.64.0/19",
      "AllowedPattern": "[a-zA-Z0-9]+\\..+"
    },
    "VPCCIDR": {
      "Description": "CIDR Block for the VPC",
      "Type": "String",
      "Default": "10.0.0.0/16",
      "AllowedPattern": "[a-zA-Z0-9]+\\..+"
    },
    "RDGW1PrivateIp": {
      "Description": "Fixed private IP for the first RD Gateway located in AZ1",
      "Type": "String",
      "Default": "10.0.32.11"
    },
    "RDGW2PrivateIp": {
      "Description": "Fixed private IP for the second RD Gateway located in AZ2",
      "Type": "String",
      "Default": "10.0.96.11"
    }
  },
  "Mappings": {
    "AWSInstanceType2Arch": {
      "m1.small": {
        "Arch": "64"
      },
      "m1.medium": {
        "Arch": "64"
      },
      "m1.large": {
        "Arch": "64"
      },
      "m2.xlarge": {
        "Arch": "64"
      },
      "t2.small": {
        "Arch": "64"
      },
      "t2.medium": {
        "Arch": "64"
      },
      "m2.2xlarge": {
        "Arch": "64"
      },
      "m2.4xlarge": {
        "Arch": "64"
      },
      "m3.xlarge": {
        "Arch": "64"
      },
      "c1.medium": {
        "Arch": "64"
      },
      "c1.xlarge": {
        "Arch": "64"
      },
      "m4.xlarge": {
        "Arch": "64"
      },
      "m4.2xlarge": {
        "Arch": "64"
      },
      "m4.4xlarge": {
        "Arch": "64"
      }
    },
    "AWSRegionArch2AMI": {
      "us-east-1": {
        "64": "ami-e4034a8e"
      },
      "us-west-2": {
        "64": "ami-b25e42d3"
      },
      "us-west-1": {
        "64": "ami-a99df5c9"
      },
      "eu-west-1": {
        "64": "ami-1ffa5a6c"
      },
      "eu-central-1": {
        "64": "ami-c64559aa"
      },
      "ap-southeast-1": {
        "64": "ami-1992517a"
      },
      "ap-northeast-1": {
        "64": "ami-fe436b90"
      },
      "sa-east-1": {
        "64": "ami-0abd3966"
      },
      "ap-southeast-2": {
        "64": "ami-cec69ead"
      }
    },
    "AWSRegionArchNatAMI": {
      "us-east-1": {
        "64": "ami-4c9e4b24"
      },
      "us-west-2": {
        "64": "ami-bb69128b"
      },
      "us-west-1": {
        "64": "ami-2b2b296e"
      },
      "eu-west-1": {
        "64": "ami-3760b040"
      },
      "eu-central-1": {
        "64": "ami-204c7a3d"
      },
      "ap-southeast-1": {
        "64": "ami-b082dae2"
      },
      "ap-southeast-2": {
        "64": "ami-996402a3"
      },
      "ap-northeast-1": {
        "64": "ami-55c29e54"
      },
      "sa-east-1": {
        "64": "ami-b972dba4"
      }
    }
  },
  "Resources": {
    "VPC": {
      "Type": "AWS::EC2::VPC",
      "Properties": {
        "CidrBlock": {
          "Ref": "VPCCIDR"
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "Public"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89"
        }
      }
    },
    "DMZSubnet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "CidrBlock": {
          "Ref": "DMZ1CIDR"
        },
        "AvailabilityZone": {
          "Fn::Select": [
            0,
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "Public"
          },
          {
            "Key": "Role",
            "Value": "DMZ 1 Subnet"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "041936eb-eb5f-49e7-9408-9aa6ff663397"
        }
      }
    },
    "DMZ2Subnet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "CidrBlock": {
          "Ref": "DMZ2CIDR"
        },
        "AvailabilityZone": {
          "Fn::Select": [
            1,
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "Public"
          },
          {
            "Key": "Role",
            "Value": "DMZ 2 Subnet"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "5e811e0d-62d0-47a5-a08c-6dbc07e4af98"
        }
      }
    },
    "PrivateSubnet1": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "CidrBlock": {
          "Ref": "PrivSub1CIDR"
        },
        "AvailabilityZone": {
          "Fn::Select": [
            0,
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "Private"
          },
          {
            "Key": "Role",
            "Value": "AD1 Subnet"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "cc4da199-5316-45aa-888c-94d7e8ca2f3c"
        }
      }
    },
    "PrivateSubnet2": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "CidrBlock": {
          "Ref": "PrivSub2CIDR"
        },
        "AvailabilityZone": {
          "Fn::Select": [
            1,
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "Private"
          },
          {
            "Key": "Role",
            "Value": "AD2 Subnet"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "608e1206-2e1a-4b25-bc42-9662cf8739c4"
        }
      }
    },
    "InternetGateway": {
      "Type": "AWS::EC2::InternetGateway",
      "Properties": {
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "Public"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "59755265-3f00-4ba4-948b-8823fbcf801b"
        }
      }
    },
    "AttachGateway": {
      "Type": "AWS::EC2::VPCGatewayAttachment",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "InternetGatewayId": {
          "Ref": "InternetGateway"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "eaccd317-3d73-47a3-ac49-8f098e691c77"
        }
      }
    },
    "DMZRouteTable": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "DMZ"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "b13aa241-08b2-4845-ad0d-9ef55cb9c539"
        }
      }
    },
    "DMZRoute": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "RouteTableId": {
          "Ref": "DMZRouteTable"
        },
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "InternetGateway"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "6368c585-7378-4856-ab8e-fb06c671c7da"
        }
      }
    },
    "DMZ1SubnetRouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "DMZSubnet"
        },
        "RouteTableId": {
          "Ref": "DMZRouteTable"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "8e69fb40-00d4-4e8b-8078-17c8185020d0"
        }
      }
    },
    "DMZ2SubnetRouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "DMZ2Subnet"
        },
        "RouteTableId": {
          "Ref": "DMZRouteTable"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "a1fb11aa-5f5c-4c52-af88-dc987f68893e"
        }
      }
    },
    "PrivateRouteTable": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "AZ1 Private"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "7776843e-8eea-44e3-8a14-9301f503273d"
        }
      }
    },
    "PrivateRoute": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "RouteTableId": {
          "Ref": "PrivateRouteTable"
        },
        "DestinationCidrBlock": "0.0.0.0/0",
        "InstanceId": {
          "Ref": "NAT1"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "58630e94-18ff-4115-bdb6-870cf0d72d2c"
        }
      }
    },
    "PrivateRouteTable2": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {
          "Ref": "VPC"
        },
        "Tags": [
          {
            "Key": "Application",
            "Value": {
              "Ref": "AWS::StackName"
            }
          },
          {
            "Key": "Network",
            "Value": "AZ2 Private"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "029fa68b-9c8b-4c3c-9f4f-cd535568aa54"
        }
      }
    },
    "PrivateRoute2": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "RouteTableId": {
          "Ref": "PrivateRouteTable2"
        },
        "DestinationCidrBlock": "0.0.0.0/0",
        "InstanceId": {
          "Ref": "NAT2"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "16c1bba6-d6b6-40d2-ab03-c5a0fa8447b1"
        }
      }
    },
    "PrivateSubnetRouteTableAssociation1": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "PrivateSubnet1"
        },
        "RouteTableId": {
          "Ref": "PrivateRouteTable"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "120f358d-67a8-4c04-bb87-386c2c411975"
        }
      }
    },
    "PrivateSubnetRouteTableAssociation2": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "PrivateSubnet2"
        },
        "RouteTableId": {
          "Ref": "PrivateRouteTable2"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "70d8a70a-605b-4e31-aa6f-59ae495d4617"
        }
      }
    },
    "RdgwEIP": {
      "Type": "AWS::EC2::EIP",
      "Properties": {
        "Domain": "vpc",
        "InstanceId": {
          "Ref": "RDGateway"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "84da101e-897f-44b2-b133-05fcd6c5864c"
        }
      }
    },
    "Rdgw2EIP": {
      "Type": "AWS::EC2::EIP",
      "Properties": {
        "Domain": "vpc",
        "InstanceId": {
          "Ref": "RDGateway2"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "c03d16cb-5720-49d1-a3c1-2299eabf6fe7"
        }
      }
    },
    "NAT1": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "ImageId": {
          "Fn::FindInMap": [
            "AWSRegionArchNatAMI",
            {
              "Ref": "AWS::Region"
            },
            {
              "Fn::FindInMap": [
                "AWSInstanceType2Arch",
                {
                  "Ref": "NATInstanceType"
                },
                "Arch"
              ]
            }
          ]
        },
        "InstanceType": {
          "Ref": "NATInstanceType"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "NAT1"
          }
        ],
        "NetworkInterfaces": [
          {
            "GroupSet": [
              {
                "Ref": "NATSecurityGroup"
              }
            ],
            "AssociatePublicIpAddress": "true",
            "DeviceIndex": "0",
            "DeleteOnTermination": "true",
            "SubnetId": {
              "Ref": "DMZSubnet"
            }
          }
        ],
        "KeyName": {
          "Ref": "KeyPairName"
        },
        "SourceDestCheck": "false"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "e5a946ca-836f-47a3-9e70-ee06efc1a84b"
        }
      }
    },
    "NAT2": {
      "Type": "AWS::EC2::Instance",
      "DependsOn": "NAT1",
      "Properties": {
        "ImageId": {
          "Fn::FindInMap": [
            "AWSRegionArchNatAMI",
            {
              "Ref": "AWS::Region"
            },
            {
              "Fn::FindInMap": [
                "AWSInstanceType2Arch",
                {
                  "Ref": "NATInstanceType"
                },
                "Arch"
              ]
            }
          ]
        },
        "InstanceType": {
          "Ref": "NATInstanceType"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "NAT2"
          }
        ],
        "NetworkInterfaces": [
          {
            "GroupSet": [
              {
                "Ref": "NATSecurityGroup"
              }
            ],
            "AssociatePublicIpAddress": "true",
            "DeviceIndex": "0",
            "DeleteOnTermination": "true",
            "SubnetId": {
              "Ref": "DMZ2Subnet"
            }
          }
        ],
        "KeyName": {
          "Ref": "KeyPairName"
        },
        "SourceDestCheck": "false"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "f0575e08-834c-40f2-a2cd-97b812356f7d"
        }
      }
    },
    "RDGateway": {
      "Type": "AWS::EC2::Instance",
      "DependsOn": "NAT1",
      "Metadata": {
        "AWS::CloudFormation::Init": {
          "configSets": {
            "config": [
              "setup",
              "rename",
              "installESG",
              "finalize"
            ]
          },
          "setup": {
            "files": {
              "c:\\cfn\\cfn-hup.conf": {
                "content": {
                  "Fn::Join": [
                    "",
                    [
                      "[main]\n",
                      "stack=",
                      {
                        "Ref": "AWS::StackName"
                      },
                      "\n",
                      "region=",
                      {
                        "Ref": "AWS::Region"
                      },
                      "\n"
                    ]
                  ]
                }
              },
              "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf": {
                "content": {
                  "Fn::Join": [
                    "",
                    [
                      "[cfn-auto-reloader-hook]\n",
                      "triggers=post.update\n",
                      "path=Resources.RDGateway.Metadata.AWS::CloudFormation::Init\n",
                      "action=cfn-init.exe -v -c config -s ",
                      {
                        "Ref": "AWS::StackId"
                      },
                      " -r RDGateway",
                      " --region ",
                      {
                        "Ref": "AWS::Region"
                      },
                      "\n"
                    ]
                  ]
                }
              },
              "c:\\cfn\\scripts\\Configure-ESG.ps1": {
                "source": "https://s3.amazonaws.com/quickstart-reference/microsoft/activedirectory/latest/scripts/Configure-ESG.ps1"
              }
            },
            "services": {
              "windows": {
                "cfn-hup": {
                  "enabled": "true",
                  "ensureRunning": "true",
                  "files": [
                    "c:\\cfn\\cfn-hup.conf",
                    "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf"
                  ]
                }
              }
            }
          },
          "rename": {
            "commands": {
              "1-execute-powershell-script-RenameComputer": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe Rename-Computer -NewName ",
                      {
                        "Ref": "ESGNetBIOSName1"
                      },
                      " -Restart"
                    ]
                  ]
                },
                "waitAfterCompletion": "forever"
              }
            }
          },
          "installESG": {
            "commands": {
              "a-install-rds": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe \"Install-WindowsFeature RDS-Gateway,RSAT-RDS-Gateway\""
                    ]
                  ]
                }
              },
              "b-create-admin": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "net user /add ",
                      {
                        "Ref": "AdminUser"
                      },
                      " ",
                      {
                        "Ref": "AdminPassword"
                      }
                    ]
                  ]
                }
              },
              "c-set-admin-group": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "net localgroup Administrators ",
                      {
                        "Ref": "AdminUser"
                      },
                      " /ADD"
                    ]
                  ]
                }
              },
              "d-configure-rdgw": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe -ExecutionPolicy RemoteSigned",
                      " C:\\cfn\\scripts\\Configure-ESG.ps1 -ServerFQDN ",
                      {
                        "Ref": "ESGNetBIOSName1"
                      },
                      ".",
                      {
                        "Ref": "DomainDNSName"
                      },
                      " -DomainNetBiosName BUILTIN -GroupName administrators -UserName ",
                      {
                        "Ref": "AdminUser"
                      }
                    ]
                  ]
                }
              }
            }
          },
          "finalize": {
            "commands": {
              "1-signal-success": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "cfn-signal.exe -e 0 \"",
                      {
                        "Ref": "RDGWWaitHandle"
                      },
                      "\""
                    ]
                  ]
                }
              }
            }
          }
        },
        "AWS::CloudFormation::Designer": {
          "id": "2310b412-de3c-4688-892e-2fd2f88bf1ae"
        }
      },
      "Properties": {
        "ImageId": {
          "Fn::FindInMap": [
            "AWSRegionArch2AMI",
            {
              "Ref": "AWS::Region"
            },
            {
              "Fn::FindInMap": [
                "AWSInstanceType2Arch",
                {
                  "Ref": "RDGWInstanceType"
                },
                "Arch"
              ]
            }
          ]
        },
        "InstanceType": {
          "Ref": "RDGWInstanceType"
        },
        "SubnetId": {
          "Ref": "DMZSubnet"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "RDGW1"
          }
        ],
        "BlockDeviceMappings": [
          {
            "DeviceName": "/dev/sda1",
            "Ebs": {
              "VolumeSize": "50",
              "VolumeType": "gp2"
            }
          }
        ],
        "SecurityGroupIds": [
          {
            "Ref": "RDGWSecurityGroup"
          }
        ],
        "PrivateIpAddress": {
          "Ref": "RDGW1PrivateIp"
        },
        "KeyName": {
          "Ref": "KeyPairName"
        },
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "<script>\n",
                "cfn-init.exe -v -c config -s ",
                {
                  "Ref": "AWS::StackId"
                },
                " -r RDGateway",
                " --region ",
                {
                  "Ref": "AWS::Region"
                },
                "\n",
                "</script>\n"
              ]
            ]
          }
        }
      }
    },
    "RDGateway2": {
      "Type": "AWS::EC2::Instance",
      "DependsOn": "NAT2",
      "Metadata": {
        "AWS::CloudFormation::Init": {
          "configSets": {
            "config": [
              "setup",
              "rename",
              "installESG",
              "finalize"
            ]
          },
          "setup": {
            "files": {
              "c:\\cfn\\cfn-hup.conf": {
                "content": {
                  "Fn::Join": [
                    "",
                    [
                      "[main]\n",
                      "stack=",
                      {
                        "Ref": "AWS::StackName"
                      },
                      "\n",
                      "region=",
                      {
                        "Ref": "AWS::Region"
                      },
                      "\n"
                    ]
                  ]
                }
              },
              "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf": {
                "content": {
                  "Fn::Join": [
                    "",
                    [
                      "[cfn-auto-reloader-hook]\n",
                      "triggers=post.update\n",
                      "path=Resources.RDGateway2.Metadata.AWS::CloudFormation::Init\n",
                      "action=cfn-init.exe -v -c config -s ",
                      {
                        "Ref": "AWS::StackId"
                      },
                      " -r RDGateway2",
                      " --region ",
                      {
                        "Ref": "AWS::Region"
                      },
                      "\n"
                    ]
                  ]
                }
              },
              "c:\\cfn\\scripts\\Configure-ESG.ps1": {
                "source": "https://s3.amazonaws.com/quickstart-reference/microsoft/activedirectory/latest/scripts/Configure-ESG.ps1"
              }
            },
            "services": {
              "windows": {
                "cfn-hup": {
                  "enabled": "true",
                  "ensureRunning": "true",
                  "files": [
                    "c:\\cfn\\cfn-hup.conf",
                    "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf"
                  ]
                }
              }
            }
          },
          "rename": {
            "commands": {
              "1-execute-powershell-script-RenameComputer": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe Rename-Computer -NewName ",
                      {
                        "Ref": "ESGNetBIOSName2"
                      },
                      " -Restart"
                    ]
                  ]
                },
                "waitAfterCompletion": "forever"
              }
            }
          },
          "installESG": {
            "commands": {
              "a-install-rds": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe \"Install-WindowsFeature RDS-Gateway,RSAT-RDS-Gateway\""
                    ]
                  ]
                }
              },
              "b-create-admin": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "net user /add ",
                      {
                        "Ref": "AdminUser"
                      },
                      " ",
                      {
                        "Ref": "AdminPassword"
                      }
                    ]
                  ]
                }
              },
              "c-set-admin-group": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "net localgroup Administrators ",
                      {
                        "Ref": "AdminUser"
                      },
                      " /ADD"
                    ]
                  ]
                }
              },
              "e-configure-rdgw": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe -ExecutionPolicy RemoteSigned",
                      " C:\\cfn\\scripts\\Configure-ESG.ps1 -ServerFQDN ",
                      {
                        "Ref": "ESGNetBIOSName2"
                      },
                      ".",
                      {
                        "Ref": "DomainDNSName"
                      },
                      " -DomainNetBiosName BUILTIN -GroupName administrators -UserName ",
                      {
                        "Ref": "AdminUser"
                      }
                    ]
                  ]
                }
              }
            }
          },
          "finalize": {
            "commands": {
              "1-signal-success": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "cfn-signal.exe -e 0 \"",
                      {
                        "Ref": "RDGW2WaitHandle"
                      },
                      "\""
                    ]
                  ]
                }
              }
            }
          }
        },
        "AWS::CloudFormation::Designer": {
          "id": "a6103fab-4353-45a3-9961-5eace1f88773"
        }
      },
      "Properties": {
        "ImageId": {
          "Fn::FindInMap": [
            "AWSRegionArch2AMI",
            {
              "Ref": "AWS::Region"
            },
            {
              "Fn::FindInMap": [
                "AWSInstanceType2Arch",
                {
                  "Ref": "RDGWInstanceType"
                },
                "Arch"
              ]
            }
          ]
        },
        "InstanceType": {
          "Ref": "RDGWInstanceType"
        },
        "SubnetId": {
          "Ref": "DMZ2Subnet"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "RDGW2"
          }
        ],
        "BlockDeviceMappings": [
          {
            "DeviceName": "/dev/sda1",
            "Ebs": {
              "VolumeSize": "50",
              "VolumeType": "gp2"
            }
          }
        ],
        "SecurityGroupIds": [
          {
            "Ref": "RDGWSecurityGroup"
          }
        ],
        "PrivateIpAddress": {
          "Ref": "RDGW2PrivateIp"
        },
        "KeyName": {
          "Ref": "KeyPairName"
        },
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "<script>\n",
                "cfn-init.exe -v -c config -s ",
                {
                  "Ref": "AWS::StackId"
                },
                " -r RDGateway2",
                " --region ",
                {
                  "Ref": "AWS::Region"
                },
                "\n",
                "</script>\n"
              ]
            ]
          }
        }
      }
    },
    "RDGWWaitCondition": {
      "Type": "AWS::CloudFormation::WaitCondition",
      "DependsOn": "RDGateway",
      "Properties": {
        "Handle": {
          "Ref": "RDGWWaitHandle"
        },
        "Timeout": "3000"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "948f0f15-222a-47a8-8429-81361e23ff66"
        }
      }
    },
    "RDGWWaitHandle": {
      "Type": "AWS::CloudFormation::WaitConditionHandle",
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "8ddae13b-2b59-426d-a23a-cc4a389624ae"
        }
      }
    },
    "RDGW2WaitCondition": {
      "Type": "AWS::CloudFormation::WaitCondition",
      "DependsOn": "RDGateway2",
      "Properties": {
        "Handle": {
          "Ref": "RDGW2WaitHandle"
        },
        "Timeout": "3000"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "013deb92-9da8-4d94-ae21-8ea73f6e6208"
        }
      }
    },
    "RDGW2WaitHandle": {
      "Type": "AWS::CloudFormation::WaitConditionHandle",
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "67cdee27-9545-41d7-b51b-1a64c3c271cb"
        }
      }
    },
    "NATSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Enables SSH access to NAT1 in AZ1 via port 22 and outbound internet access via private subnets",
        "VpcId": {
          "Ref": "VPC"
        },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": "22",
            "ToPort": "22",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "icmp",
            "FromPort": "-1",
            "ToPort": "-1",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "-1",
            "FromPort": "1",
            "ToPort": "65535",
            "CidrIp": {
              "Ref": "PrivSub1CIDR"
            }
          },
          {
            "IpProtocol": "icmp",
            "FromPort": "-1",
            "ToPort": "-1",
            "CidrIp": {
              "Ref": "PrivSub1CIDR"
            }
          },
          {
            "IpProtocol": "-1",
            "FromPort": "1",
            "ToPort": "65535",
            "CidrIp": {
              "Ref": "PrivSub2CIDR"
            }
          },
          {
            "IpProtocol": "icmp",
            "FromPort": "-1",
            "ToPort": "-1",
            "CidrIp": {
              "Ref": "PrivSub2CIDR"
            }
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "cfb16228-08bb-4519-a914-6113982a10c9"
        }
      }
    },
    "RDGWSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Enable RDP access from the Internet",
        "VpcId": {
          "Ref": "VPC"
        },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": "3389",
            "ToPort": "3389",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "icmp",
            "FromPort": "-1",
            "ToPort": "-1",
            "CidrIp": "0.0.0.0/0"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "d558c51c-eef3-4b9c-bbd0-c8c3f770ccc4"
        }
      }
    },
    "ECGrid1": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "SubnetId": {
          "Ref": "PrivateSubnet1"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Init": {
          "configSets": {
            "config": [
              "setup",
              "rename",
              "downloadSoftware",
              "installDB",
              "installEC",
              "configuregrid",
              "finalize"
            ]
          },
          "setup": {
            "files": {
              "c:\\cfn\\cfn-hup.conf": {
                "content": {
                  "Fn::Join": [
                    "",
                    [
                      "[main]\n",
                      "stack=",
                      {
                        "Ref": "AWS::StackName"
                      },
                      "\n",
                      "region=",
                      {
                        "Ref": "AWS::Region"
                      },
                      "\n"
                    ]
                  ]
                }
              },
              "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf": {
                "content": {
                  "Fn::Join": [
                    "",
                    [
                      "[cfn-auto-reloader-hook]\n",
                      "triggers=post.update\n",
                      "path=Resources.RDGateway.Metadata.AWS::CloudFormation::Init\n",
                      "action=cfn-init.exe -v -c config -s ",
                      {
                        "Ref": "AWS::StackId"
                      },
                      " -r RDGateway",
                      " --region ",
                      {
                        "Ref": "AWS::Region"
                      },
                      "\n"
                    ]
                  ]
                }
              },
              "c:\\cfn\\scripts\\Configure-Grid.ps1": {
                "source": "https://s3.amazonaws.com/quickstart-reference/microsoft/activedirectory/latest/scripts/Configure-Grid.ps1"
              }
            },
            "services": {
              "windows": {
                "cfn-hup": {
                  "enabled": "true",
                  "ensureRunning": "true",
                  "files": [
                    "c:\\cfn\\cfn-hup.conf",
                    "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf"
                  ]
                }
              }
            }
          },
          "rename": {
            "commands": {
              "1-execute-powershell-script-RenameComputer": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe Rename-Computer -NewName ",
                      {
                        "Ref": "GRIDNetBIOSName"
                      },
                      " -Restart"
                    ]
                  ]
                },
                "waitAfterCompletion": "forever"
              }
            }
          },
          "downloadgridsoftware": {
            "commands": {
              "DownloadSoftware": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe -ExecutionPolicy RemoteSigned",
                      " C:\\cfn\\scripts\\DownloadGridSoftware.ps1 -ServerFQDN ",
                      {
                        "Ref": "GRIDNetBIOSName"
                      },
                      " -Restart"
                    ]
                  ]
                },
                "waitAfterCompletion": "forever"
              }
            }
          },
          "configuregrid": {
            "commands": {
              "a-install-rds": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe \"Install-WindowsFeature RDS-Gateway,RSAT-RDS-Gateway\""
                    ]
                  ]
                }
              },
              "b-create-admin": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "net user /add ",
                      {
                        "Ref": "AdminUser"
                      },
                      " ",
                      {
                        "Ref": "AdminPassword"
                      }
                    ]
                  ]
                }
              },
              "c-set-admin-group": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "net localgroup Administrators ",
                      {
                        "Ref": "AdminUser"
                      },
                      " /ADD"
                    ]
                  ]
                }
              },
              "d-configure-rdgw": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "powershell.exe -ExecutionPolicy RemoteSigned",
                      " C:\\cfn\\scripts\\Configure-ESG.ps1 -ServerFQDN ",
                      {
                        "Ref": "GRIDNetBIOSName"
                      },
                      ".",
                      {
                        "Ref": "DomainDNSName"
                      },
                      " -DomainNetBiosName BUILTIN -GroupName administrators -UserName ",
                      {
                        "Ref": "AdminUser"
                      }
                    ]
                  ]
                }
              }
            }
          },
          "finalize": {
            "commands": {
              "1-signal-success": {
                "command": {
                  "Fn::Join": [
                    "",
                    [
                      "cfn-signal.exe -e 0 \"",
                      {
                        "Ref": "RDGWWaitHandle"
                      },
                      "\""
                    ]
                  ]
                }
              }
            }
          }
        },
        "AWS::CloudFormation::Designer": {
          "id": "03847c68-869b-4ffa-822d-bb1548b72ca7"
        }
      }
    }
  },
  "Outputs": {
    "RDGW1ElasticIP": {
      "Value": {
        "Ref": "RdgwEIP"
      },
      "Description": "Elastic IP address of the first Remote Desktop Gateway (RDGW1) in AZ1"
    },
    "RootCert1": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "c:\\",
            {
              "Ref": "ESGNetBIOSName1"
            },
            ".cer"
          ]
        ]
      },
      "Description": "Location of the root SSL certificate on the first Remote Desktop Gateway (RDGW1) in AZ1"
    },
    "RDGW2ElasticIP": {
      "Value": {
        "Ref": "Rdgw2EIP"
      },
      "Description": "Elastic IP address of the second Remote Desktop Gateway (RDGW2) in AZ2"
    },
    "RootCert2": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "c:\\",
            {
              "Ref": "ESGNetBIOSName2"
            },
            ".cer"
          ]
        ]
      },
      "Description": "Location of the root SSL certificate on the second Remote Desktop Gateway (RDGW2) in AZ2"
    }
  },
  "Metadata": {
    "AWS::CloudFormation::Designer": {
      "67cdee27-9545-41d7-b51b-1a64c3c271cb": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 60,
          "y": 1110
        },
        "z": 1,
        "embeds": []
      },
      "8ddae13b-2b59-426d-a23a-cc4a389624ae": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 180,
          "y": 1110
        },
        "z": 1,
        "embeds": []
      },
      "59755265-3f00-4ba4-948b-8823fbcf801b": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 300,
          "y": 1110
        },
        "z": 1,
        "embeds": []
      },
      "4e235794-fb9a-4743-82b7-ae1fb0b1ca89": {
        "size": {
          "width": 1050,
          "height": 960
        },
        "position": {
          "x": 60,
          "y": 90
        },
        "z": 1,
        "embeds": [
          "d558c51c-eef3-4b9c-bbd0-c8c3f770ccc4",
          "cfb16228-08bb-4519-a914-6113982a10c9",
          "029fa68b-9c8b-4c3c-9f4f-cd535568aa54",
          "7776843e-8eea-44e3-8a14-9301f503273d",
          "b13aa241-08b2-4845-ad0d-9ef55cb9c539",
          "608e1206-2e1a-4b25-bc42-9662cf8739c4",
          "cc4da199-5316-45aa-888c-94d7e8ca2f3c",
          "5e811e0d-62d0-47a5-a08c-6dbc07e4af98",
          "041936eb-eb5f-49e7-9408-9aa6ff663397"
        ]
      },
      "d558c51c-eef3-4b9c-bbd0-c8c3f770ccc4": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 90,
          "y": 750
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": []
      },
      "cfb16228-08bb-4519-a914-6113982a10c9": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 210,
          "y": 750
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": []
      },
      "029fa68b-9c8b-4c3c-9f4f-cd535568aa54": {
        "size": {
          "width": 240,
          "height": 240
        },
        "position": {
          "x": 780,
          "y": 150
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": [
          "16c1bba6-d6b6-40d2-ab03-c5a0fa8447b1"
        ]
      },
      "7776843e-8eea-44e3-8a14-9301f503273d": {
        "size": {
          "width": 240,
          "height": 240
        },
        "position": {
          "x": 480,
          "y": 450
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": [
          "58630e94-18ff-4115-bdb6-870cf0d72d2c"
        ]
      },
      "b13aa241-08b2-4845-ad0d-9ef55cb9c539": {
        "size": {
          "width": 240,
          "height": 240
        },
        "position": {
          "x": 480,
          "y": 150
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": [
          "6368c585-7378-4856-ab8e-fb06c671c7da"
        ]
      },
      "6368c585-7378-4856-ab8e-fb06c671c7da": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 510,
          "y": 210
        },
        "z": 3,
        "parent": "b13aa241-08b2-4845-ad0d-9ef55cb9c539",
        "embeds": [],
        "references": [
          "59755265-3f00-4ba4-948b-8823fbcf801b"
        ]
      },
      "eaccd317-3d73-47a3-ac49-8f098e691c77": {
        "source": {
          "id": "59755265-3f00-4ba4-948b-8823fbcf801b"
        },
        "target": {
          "id": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89"
        },
        "z": 1
      },
      "608e1206-2e1a-4b25-bc42-9662cf8739c4": {
        "size": {
          "width": 150,
          "height": 150
        },
        "position": {
          "x": 780,
          "y": 660
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": []
      },
      "70d8a70a-605b-4e31-aa6f-59ae495d4617": {
        "source": {
          "id": "029fa68b-9c8b-4c3c-9f4f-cd535568aa54"
        },
        "target": {
          "id": "608e1206-2e1a-4b25-bc42-9662cf8739c4"
        },
        "z": 2
      },
      "cc4da199-5316-45aa-888c-94d7e8ca2f3c": {
        "size": {
          "width": 150,
          "height": 150
        },
        "position": {
          "x": 780,
          "y": 450
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": [
          "03847c68-869b-4ffa-822d-bb1548b72ca7"
        ]
      },
      "120f358d-67a8-4c04-bb87-386c2c411975": {
        "source": {
          "id": "7776843e-8eea-44e3-8a14-9301f503273d"
        },
        "target": {
          "id": "cc4da199-5316-45aa-888c-94d7e8ca2f3c"
        },
        "z": 2
      },
      "5e811e0d-62d0-47a5-a08c-6dbc07e4af98": {
        "size": {
          "width": 330,
          "height": 240
        },
        "position": {
          "x": 90,
          "y": 450
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": [
          "f0575e08-834c-40f2-a2cd-97b812356f7d",
          "a6103fab-4353-45a3-9961-5eace1f88773"
        ]
      },
      "a1fb11aa-5f5c-4c52-af88-dc987f68893e": {
        "source": {
          "id": "b13aa241-08b2-4845-ad0d-9ef55cb9c539"
        },
        "target": {
          "id": "5e811e0d-62d0-47a5-a08c-6dbc07e4af98"
        },
        "z": 2
      },
      "041936eb-eb5f-49e7-9408-9aa6ff663397": {
        "size": {
          "width": 330,
          "height": 240
        },
        "position": {
          "x": 90,
          "y": 150
        },
        "z": 2,
        "parent": "4e235794-fb9a-4743-82b7-ae1fb0b1ca89",
        "embeds": [
          "e5a946ca-836f-47a3-9e70-ee06efc1a84b",
          "2310b412-de3c-4688-892e-2fd2f88bf1ae"
        ]
      },
      "e5a946ca-836f-47a3-9e70-ee06efc1a84b": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 120,
          "y": 210
        },
        "z": 3,
        "parent": "041936eb-eb5f-49e7-9408-9aa6ff663397",
        "embeds": [],
        "isrelatedto": [
          "cfb16228-08bb-4519-a914-6113982a10c9"
        ]
      },
      "2310b412-de3c-4688-892e-2fd2f88bf1ae": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 240,
          "y": 210
        },
        "z": 3,
        "parent": "041936eb-eb5f-49e7-9408-9aa6ff663397",
        "embeds": [],
        "ismemberof": [
          "d558c51c-eef3-4b9c-bbd0-c8c3f770ccc4"
        ],
        "dependson": [
          "e5a946ca-836f-47a3-9e70-ee06efc1a84b"
        ]
      },
      "948f0f15-222a-47a8-8429-81361e23ff66": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 420,
          "y": 1110
        },
        "z": 1,
        "embeds": [],
        "references": [
          "8ddae13b-2b59-426d-a23a-cc4a389624ae"
        ],
        "dependson": [
          "2310b412-de3c-4688-892e-2fd2f88bf1ae"
        ]
      },
      "84da101e-897f-44b2-b133-05fcd6c5864c": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 540,
          "y": 1110
        },
        "z": 1,
        "embeds": [],
        "isconnectedto": [
          "2310b412-de3c-4688-892e-2fd2f88bf1ae"
        ]
      },
      "f0575e08-834c-40f2-a2cd-97b812356f7d": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 120,
          "y": 510
        },
        "z": 3,
        "parent": "5e811e0d-62d0-47a5-a08c-6dbc07e4af98",
        "embeds": [],
        "dependson": [
          "e5a946ca-836f-47a3-9e70-ee06efc1a84b"
        ],
        "isrelatedto": [
          "cfb16228-08bb-4519-a914-6113982a10c9"
        ]
      },
      "a6103fab-4353-45a3-9961-5eace1f88773": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 240,
          "y": 510
        },
        "z": 3,
        "parent": "5e811e0d-62d0-47a5-a08c-6dbc07e4af98",
        "embeds": [],
        "ismemberof": [
          "d558c51c-eef3-4b9c-bbd0-c8c3f770ccc4"
        ],
        "dependson": [
          "f0575e08-834c-40f2-a2cd-97b812356f7d"
        ]
      },
      "013deb92-9da8-4d94-ae21-8ea73f6e6208": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 660,
          "y": 1110
        },
        "z": 1,
        "embeds": [],
        "references": [
          "67cdee27-9545-41d7-b51b-1a64c3c271cb"
        ],
        "dependson": [
          "a6103fab-4353-45a3-9961-5eace1f88773"
        ]
      },
      "c03d16cb-5720-49d1-a3c1-2299eabf6fe7": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 780,
          "y": 1110
        },
        "z": 1,
        "embeds": [],
        "isconnectedto": [
          "a6103fab-4353-45a3-9961-5eace1f88773"
        ]
      },
      "16c1bba6-d6b6-40d2-ab03-c5a0fa8447b1": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 810,
          "y": 210
        },
        "z": 3,
        "parent": "029fa68b-9c8b-4c3c-9f4f-cd535568aa54",
        "embeds": [],
        "references": [
          "f0575e08-834c-40f2-a2cd-97b812356f7d"
        ]
      },
      "58630e94-18ff-4115-bdb6-870cf0d72d2c": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 510,
          "y": 510
        },
        "z": 3,
        "parent": "7776843e-8eea-44e3-8a14-9301f503273d",
        "embeds": [],
        "references": [
          "e5a946ca-836f-47a3-9e70-ee06efc1a84b"
        ]
      },
      "8e69fb40-00d4-4e8b-8078-17c8185020d0": {
        "source": {
          "id": "b13aa241-08b2-4845-ad0d-9ef55cb9c539"
        },
        "target": {
          "id": "041936eb-eb5f-49e7-9408-9aa6ff663397"
        },
        "z": 2
      },
      "03847c68-869b-4ffa-822d-bb1548b72ca7": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 840,
          "y": 510
        },
        "z": 3,
        "parent": "cc4da199-5316-45aa-888c-94d7e8ca2f3c",
        "embeds": []
      }
    }
  }
}